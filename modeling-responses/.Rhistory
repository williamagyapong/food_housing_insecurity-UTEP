pa_stats2
names(pa_stats) <- c("Levels", "Obervations", "Percentage")
pa_stats
pa_stats2 <- FIHI_sub3 %>%
filter(permanent_address=="No") %>%
select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
names(pa_stats2) <- c("Levels", "Obervations", "Percentage")
# Make new data for EDA
eda_dat <- FIHI_sub3 %>%
dplyr::select(-ends_with("_changed"))
file_path <- dirname(rstudioapi::getSourceEditorContext()$path)
FIHI <- read.csv(paste0(file_path, '/datcsv.csv'))
#=========================================================
# Helper functions
#========================================================
na_to_zero <- function(x)
{
return(ifelse(is.na(x), 0, x ))
}
na_to_99 <- function(x)
{
return(ifelse(is.na(x), 99, x ))
}
# This function helps restore back any prior missingness. Care must be taken in
# order not to apply it to a variable where 0 has a different meaning.
zero_to_na <- function(x)
{
return(ifelse(x == 0, NA, x ))
}
FIHI_new <- FIHI %>%
# change column names to lowercase
rename_with(tolower) %>%
# Removing unwanted variables
select(-externalid, -satellite, -email, -datetime, -carddata,
-starts_with(c("q5", "q8","q16", "q18", "q21", "q29", "q24", "q36", "q37", "q38", "q39"))
) %>%
# Strip off trailing strings to get clean variable names
rename_with(~gsub('\\..*', '', .x))
##------- Consolidating common variables split across levels -----
# We create dummy columns for the number of non-na values within each range for the targeted variable
FIHI_new_ <- FIHI_new %>%
mutate(q6Count = rowSums(!is.na(select(., starts_with("q6")))),
q7Count = rowSums(!is.na(select(., starts_with("q7")))),
q11Count = rowSums(!is.na(select(., starts_with("q11")))),
q25Count = rowSums(!is.na(select(., starts_with("q25"))))) %>%
# change the 0 level for q25_7 to avoid issues with approach for working on these multiple-response variables
mutate(q25_7 = ifelse(q25_7 == 0, 7, q25_7))
# Gender:
#    - level 7: Mixed gender
#
# Federal Aid (q25):
#    - Not applicable -> 7
#    - Multiple sources -> 8
#    - work study is almost lost when multiple responses are sorted out,
#    so we decided to do: work study + other sources => work study
#    -
#
FIHI_sub <- FIHI_new_ %>%
mutate(across(starts_with(c("q6", "q7", "q11", "q25")), na_to_zero)) %>%
mutate(q6 = ifelse(q6Count>1, ifelse(q6_1!=0 & q6_6!=0, 1,
ifelse(q6_1!=0 & q6_4!=0, 4, 8)
),
rowSums(across(starts_with("q6_")))),
q7 = ifelse(q7Count>1, 7, rowSums(across(starts_with("q7_")))),
q11 = ifelse(q11Count>1,10, rowSums(across(starts_with("q11_")))),
q25 = ifelse(q25Count>1, ifelse(q25_2!=0, 2, 8),
rowSums(across(starts_with("q25_")))),
.after = starts_with("q4"),
.keep = "unused") %>%
relocate(q11, .after = starts_with("q10")) %>% # just to keep the order of the variables
relocate(q25, .after = starts_with("q23")) %>%
mutate(across(starts_with(c("q6", "q7", "q11", "q25")), zero_to_na))
View(FIHI_sub)
FIHI_new <- FIHI %>%
# change column names to lowercase
rename_with(tolower) %>%
# Removing unwanted variables
select(-externalid, -satellite, -email, -datetime, -carddata,
-starts_with(c("q5", "q8", "q18", "q21", "q29", "q24", "q36", "q37", "q38", "q39"))
) %>%
# Strip off trailing strings to get clean variable names
rename_with(~gsub('\\..*', '', .x))
##------- Consolidating common variables split across levels -----
# We create dummy columns for the number of non-na values within each range for the targeted variable
FIHI_new_ <- FIHI_new %>%
mutate(q6Count = rowSums(!is.na(select(., starts_with("q6")))),
q7Count = rowSums(!is.na(select(., starts_with("q7")))),
q11Count = rowSums(!is.na(select(., starts_with("q11")))),
q25Count = rowSums(!is.na(select(., starts_with("q25"))))) %>%
# change the 0 level for q25_7 to avoid issues with approach for working on these multiple-response variables
mutate(q25_7 = ifelse(q25_7 == 0, 7, q25_7))
# Gender:
#    - level 7: Mixed gender
#
# Federal Aid (q25):
#    - Not applicable -> 7
#    - Multiple sources -> 8
#    - work study is almost lost when multiple responses are sorted out,
#    so we decided to do: work study + other sources => work study
#    -
#
FIHI_sub <- FIHI_new_ %>%
mutate(across(starts_with(c("q6", "q7", "q11", "q25")), na_to_zero)) %>%
mutate(q6 = ifelse(q6Count>1, ifelse(q6_1!=0 & q6_6!=0, 1,
ifelse(q6_1!=0 & q6_4!=0, 4, 8)
),
rowSums(across(starts_with("q6_")))),
q7 = ifelse(q7Count>1, 7, rowSums(across(starts_with("q7_")))),
q11 = ifelse(q11Count>1,10, rowSums(across(starts_with("q11_")))),
q25 = ifelse(q25Count>1, ifelse(q25_2!=0, 2, 8),
rowSums(across(starts_with("q25_")))),
.after = starts_with("q4"),
.keep = "unused") %>%
relocate(q11, .after = starts_with("q10")) %>% # just to keep the order of the variables
relocate(q25, .after = starts_with("q23")) %>%
mutate(across(starts_with(c("q6", "q7", "q11", "q25")), zero_to_na))
table(FIHI_sub$q15)
table(FIHI_sub$q16)
FIHI_sub2 <- FIHI_sub %>%
mutate(q6 = ifelse(q6%in%c(2,5,7,8), 8, q6),
q7 = ifelse(q7 >=4, 3, q7),
q9 = ifelse(q9%in%c(6,7), 12, ifelse(q9%in%c(8,9,10), 13, q9)),
q10 = ifelse(q10>5, 6, q10),
# q11 = ifelse(q11>6, 7, q11),
q12 = ifelse(q12%in%2:3, 9, ifelse(q12%in%5:7, 10, ifelse(q12==0, 11, q12))),
q15 = ifelse(q15==2, 4, q16),
q25 = ifelse(q25==4, 3, q25)
)
table(FIHI_sub2$q15)
FIHI_sub2 <- FIHI_sub %>%
mutate(q6 = ifelse(q6%in%c(2,5,7,8), 8, q6),
q7 = ifelse(q7 >=4, 3, q7),
q9 = ifelse(q9%in%c(6,7), 12, ifelse(q9%in%c(8,9,10), 13, q9)),
q10 = ifelse(q10>5, 6, q10),
# q11 = ifelse(q11>6, 7, q11),
q12 = ifelse(q12%in%2:3, 9, ifelse(q12%in%5:7, 10, ifelse(q12==0, 11, q12))),
q15 = ifelse(q15==2, 4, q16),
q25 = ifelse(q25==4, 3, q25)
) %>%
select(-q16)
table(FIHI_sub2$q15)
FIHI_sub3 <- FIHI_sub2 %>%
mutate(
q1 = factor(q1, levels = 1:2,
labels = c("Full Time", "Part Time")),
q2 = factor(q2, levels = 1:3,
labels = c("Full Time", "Part Time", "No")),
q3 = factor(q3, levels = 1:2,
labels = c("On-Campus", "Off-Campus")),
q4 = factor(q4, levels = 1:2,
labels = c("19 hours or less", "More than 19 hours")),
q6 = factor(q6, levels = c(1,3,4,6,8),
labels = c("Hispanic", "Asian", "Black/African American", "White/Caucasian",
"Other")),
q7 = factor(q7, levels = 1:3,
labels = c("Female", "Male", "Non-binary/Non-conforming")),
q9 = factor(q9, levels = c(1:5,12,13,11),
labels = c("< 10,000", "10,000-19,999", "20,000-29,999", "30,000-39,000",
"40,000-49,999", "50,000-69,999", "70,000-99,999", ">=100,000")),
q10 = factor(q10, levels = 1:6,
labels = c("Freshman", "Sophomore", "Junior", "Senior",
"Masters", "Doctoral/Professional")),
q11 = factor(q11, levels = 1:10,
labels = c("Business", "Education", "Engineering", "Health Sciences",
"Liberal Arts", "Science", "Nursing", "Pharmacy",
"Other", "More than one")),
q12 = factor(q12, levels = c(1,9,4,10,8,11),
labels = c("Car (alone)", "Car (someone drives) & Carpool",
"Bus/Public transport", "Bike, Trolley, or Walk",
"Other", "Not applicable")),
q13 = factor(q13, levels = 1:4,
labels = c("Not reliable at all", "Somewhat reliable",
"Fairly reliable", "Very reliable")),
q14 = factor(q14, levels = 1:2,
labels = c("Yes", "No")),
q15 = factor(q15, levels = c(4, 1:3),
labels = c("0", "1", "2 - 3", "4 or more")),
q17 = factor(q17, levels = 1:2,
labels = c("Yes", "No")),
q19 = factor(q19, levels = 1:4,
labels = c("On-Campus", "Off-Campus with family",
"Off-Campus not with family", "Other")),
q20 = factor(q20, levels = 1:2,
labels = c("Yes", "No")),
q22 = factor(q22, levels = 1:3,
labels = c("Rarely", "Sometimes", "Often")),
q23 = factor(q23, levels = 1:2,
labels = c("Yes", "No")),
q25 = factor(q25, levels = c(1:3,5,8,7,6 ),
labels = c("Grants", "Work Study", "Loans", "Scholarship",
"Multiple Aids", "Other", "None")),
q26 = factor(q26, levels = 1:3,
labels = c("Never true", "Sometimes true", "Often true")),
q27 = factor(q27, levels = 1:3,
labels = c("Never true", "Sometimes true", "Often true")),
q28 = factor(q28, levels = 1:2,
labels = c("Yes", "No")),
q30 = factor(q30, levels = 1:2,
labels = c("Yes", "No")),
q31 = factor(q31, levels = 1:2,
labels = c("Yes", "No")),
q32 = factor(q32, levels = 1:3,
labels = c("Decreased", "About the same", "Increased")),
q33 = factor(q33, levels = 1:3,
labels = c("Decreased", "About the same", "Increased")),
q34 = factor(q34, levels = 1:3,
labels = c("Decreased", "About the same", "Increased")),
q35 = factor(q35, levels = 1:3,
labels = c("Decreased", "About the same", "Increased")),
)
table(FIHI_sub3$q15)
View(FIHI_sub)
FIHI_sub <- FIHI_sub %>%
mutate(count = rowSums(!is.na(select(., -respondentid))))
View(FIHI_sub)
table(FIHI_sub$count)
dim(FIHI_sub)
FIHI_sub <- FIHI_sub %>%
mutate(count = rowSums(!is.na(select(., -respondentid)))) %>%
filter(count > 4)
table(FIHI_sub$count)
table(as.factor(FIHI_sub$count))
# Gender:
#    - level 7: Mixed gender
#
# Federal Aid (q25):
#    - Not applicable -> 7
#    - Multiple sources -> 8
#    - work study is almost lost when multiple responses are sorted out,
#    so we decided to do: work study + other sources => work study
#    -
#
FIHI_sub <- FIHI_new_ %>%
mutate(across(starts_with(c("q6", "q7", "q11", "q25")), na_to_zero)) %>%
mutate(q6 = ifelse(q6Count>1, ifelse(q6_1!=0 & q6_6!=0, 1,
ifelse(q6_1!=0 & q6_4!=0, 4, 8)
),
rowSums(across(starts_with("q6_")))),
q7 = ifelse(q7Count>1, 7, rowSums(across(starts_with("q7_")))),
q11 = ifelse(q11Count>1,10, rowSums(across(starts_with("q11_")))),
q25 = ifelse(q25Count>1, ifelse(q25_2!=0, 2, 8),
rowSums(across(starts_with("q25_")))),
.after = starts_with("q4"),
.keep = "unused") %>%
relocate(q11, .after = starts_with("q10")) %>% # just to keep the order of the variables
relocate(q25, .after = starts_with("q23")) %>%
mutate(across(starts_with(c("q6", "q7", "q11", "q25")), zero_to_na))
FIHI_sub <- FIHI_sub %>%
mutate(count = rowSums(!is.na(select(., -respondentid)))) %>%
filter(count > 4)
table(FIHI_sub$count)
dim(FIHI_sub)
FIHI_sub2 <- FIHI_sub %>%
mutate(q6 = ifelse(q6%in%c(2,5,7,8), 8, q6),
q7 = ifelse(q7 >=4, 3, q7),
q9 = ifelse(q9%in%c(6,7), 12, ifelse(q9%in%c(8,9,10), 13, q9)),
q10 = ifelse(q10>5, 6, q10),
# q11 = ifelse(q11>6, 7, q11),
q12 = ifelse(q12%in%2:3, 9, ifelse(q12%in%5:7, 10, ifelse(q12==0, 11, q12))),
q15 = ifelse(q15==2, 4, q16),
q25 = ifelse(q25==4, 3, q25)
) %>%
select(-q16) # remove this variable since it has already been used up
FIHI_sub3 <- FIHI_sub2 %>%
mutate(
q1 = factor(q1, levels = 1:2,
labels = c("Full Time", "Part Time")),
q2 = factor(q2, levels = 1:3,
labels = c("Full Time", "Part Time", "No")),
q3 = factor(q3, levels = 1:2,
labels = c("On-Campus", "Off-Campus")),
q4 = factor(q4, levels = 1:2,
labels = c("19 hours or less", "More than 19 hours")),
q6 = factor(q6, levels = c(1,3,4,6,8),
labels = c("Hispanic", "Asian", "Black/African American", "White/Caucasian",
"Other")),
q7 = factor(q7, levels = 1:3,
labels = c("Female", "Male", "Non-binary/Non-conforming")),
q9 = factor(q9, levels = c(1:5,12,13,11),
labels = c("< 10,000", "10,000-19,999", "20,000-29,999", "30,000-39,000",
"40,000-49,999", "50,000-69,999", "70,000-99,999", ">=100,000")),
q10 = factor(q10, levels = 1:6,
labels = c("Freshman", "Sophomore", "Junior", "Senior",
"Masters", "Doctoral/Professional")),
q11 = factor(q11, levels = 1:10,
labels = c("Business", "Education", "Engineering", "Health Sciences",
"Liberal Arts", "Science", "Nursing", "Pharmacy",
"Other", "More than one")),
q12 = factor(q12, levels = c(1,9,4,10,8,11),
labels = c("Car (alone)", "Car (someone drives) & Carpool",
"Bus/Public transport", "Bike, Trolley, or Walk",
"Other", "Not applicable")),
q13 = factor(q13, levels = 1:4,
labels = c("Not reliable at all", "Somewhat reliable",
"Fairly reliable", "Very reliable")),
q14 = factor(q14, levels = 1:2,
labels = c("Yes", "No")),
q15 = factor(q15, levels = c(4, 1:3),
labels = c("0", "1", "2 - 3", "4 or more")),
q17 = factor(q17, levels = 1:2,
labels = c("Yes", "No")),
q19 = factor(q19, levels = 1:4,
labels = c("On-Campus", "Off-Campus with family",
"Off-Campus not with family", "Other")),
q20 = factor(q20, levels = 1:2,
labels = c("Yes", "No")),
q22 = factor(q22, levels = 1:3,
labels = c("Rarely", "Sometimes", "Often")),
q23 = factor(q23, levels = 1:2,
labels = c("Yes", "No")),
q25 = factor(q25, levels = c(1:3,5,8,7,6 ),
labels = c("Grants", "Work Study", "Loans", "Scholarship",
"Multiple Aids", "Other", "None")),
q26 = factor(q26, levels = 1:3,
labels = c("Never true", "Sometimes true", "Often true")),
q27 = factor(q27, levels = 1:3,
labels = c("Never true", "Sometimes true", "Often true")),
q28 = factor(q28, levels = 1:2,
labels = c("Yes", "No")),
q30 = factor(q30, levels = 1:2,
labels = c("Yes", "No")),
q31 = factor(q31, levels = 1:2,
labels = c("Yes", "No")),
q32 = factor(q32, levels = 1:3,
labels = c("Decreased", "About the same", "Increased")),
q33 = factor(q33, levels = 1:3,
labels = c("Decreased", "About the same", "Increased")),
q34 = factor(q34, levels = 1:3,
labels = c("Decreased", "About the same", "Increased")),
q35 = factor(q35, levels = 1:3,
labels = c("Decreased", "About the same", "Increased")),
)
##------------- Rename the remaining variables ---------------------
var_names <- c("respondent_id", "enrollment", "employment", "employment_type", "weekly_work_hrs", "ethnicity", "gender", "total_income", "academic_level", "college/school", "mode_transport", "transport_reliability", "living_alone", "dependents", "household_head", "residence", "permanent_address", "spent_night_elsewhere", "know_homelessness_studt", "federal_aid", "FI_q26", "FI_q27", "FI_q28", "FI_q30", "FI_q31", "expenditures_changed", "income_changed", "fed_aid_changed", "debt_changed")
names(FIHI_sub2) <- var_names
names(FIHI_sub3) <- var_names
save(FIHI_sub2, FIHI_sub3, file=paste0(file_path, '/FIHI_clean.RData'))
# Importing preprocessed data
load("FIHI_clean.RData")
table(eda_dat$spent_night_elsewhere)
summary(eda_dat$spent_night_elsewhere)
# Importing preprocessed data
load("FIHI_clean.RData")
# Make new data for EDA
eda_dat <- FIHI_sub3 %>%
dplyr::select(-ends_with("_changed"))
# Importing preprocessed data
load("FIHI_clean.RData")
# Make new data for EDA
eda_dat <- FIHI_sub3 %>%
dplyr::select(-ends_with("_changed"))
View(FIHI_sub3)
# Make new data for EDA
eda_dat <- FIHI_sub3 %>%
select(-ends_with("_changed"))
# Load required packages
library(dplyr)
# Make new data for EDA
eda_dat <- FIHI_sub3 %>%
select(-ends_with("_changed"))
pa_stats <- FIHI_sub3 %>%
select(permanent_address) %>%
group_by(permanent_address) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
names(pa_stats) <- c("Levels", "Obervations", "Percentage")
pa_stats2 <- FIHI_sub3 %>%
filter(permanent_address=="No") %>%
select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
pa_stats
knitr::opts_chunk$set(echo = F)
# Load required packages
library(dplyr)
library(stringr)
library(ggplot2)
library(RColorBrewer)
library(ggcorrplot) # for correlation plot
library(ggthemes)
library(patchwork)
library(knitr)
library(kableExtra)
library(scales) # for the percent function
# Importing preprocessed data
load("FIHI_clean.RData")
View(FIHI_sub3)
summary(FIHI_sub3$permanent_address)
pa_stats <- FIHI_sub3 %>%
select(permanent_address) %>%
group_by(permanent_address) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
names(pa_stats) <- c("Levels", "Obervations", "Percentage")
pa_stats2 <- FIHI_sub3 %>%
filter(permanent_address=="No") %>%
select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
FIHI_sub3 %>%
filter(permanent_address=="No")
pa_stats2 <- FIHI_sub3  %>%
select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
pa_stats2
View(FIHI_sub3)
pa_stats2 <- FIHI_sub3 %>%
filter(permanent_address=="No") %>%
select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
pa_stats2 <- FIHI_sub3 %>%
filter(permanent_address=="Yes") %>%
select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
pa_stats2 <- FIHI_sub3 %>%
dplyr::filter(permanent_address=="Yes") %>%
select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
pa_stats2 <- FIHI_sub3 %>%
dplyr::filter(permanent_address=="Yes") %>%
dplyr::select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
knitr::opts_chunk$set(echo = F)
# Load required packages
library(dplyr)
library(stringr)
library(ggplot2)
library(RColorBrewer)
library(ggcorrplot) # for correlation plot
library(ggthemes)
library(patchwork)
library(knitr)
library(kableExtra)
library(scales) # for the percent function
# Importing preprocessed data
load("FIHI_clean.RData")
# Make new data for EDA
# eda_dat <- FIHI_sub3 %>%
#   select(-ends_with("_changed"))
pa_stats <- FIHI_sub3 %>%
select(permanent_address) %>%
group_by(permanent_address) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
names(pa_stats) <- c("Levels", "Obervations", "Percentage")
pa_stats2 <- FIHI_sub3 %>%
dplyr::filter(permanent_address=="Yes") %>%
dplyr::select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
## For data cleaning:
# - remove participants who didn't answer a great number of questions
# - create a counts column after fixing multiple response issues to help
# identify such instances
# Tracking follow-up questions to fix incorrect missing data instances:
# Respondents who answered NO or gave a response not in favor of the follow-up
# question will incorrectly count as missing data for the follow-up questions
# - employment_type (Q3): filter out NO for employed
# - weekly_work_hrs (Q4): filter out NO for employed
# - transport_reliability (Q13): filter out Not applicable for mode_transport
# Problem with Q13 though, the same number carried over from Q12 instead of
# falling short of Not applicable respondents
# -
# - spent night elsewhere (Q22): filter out for permanent address
# -
pa_stats <- FIHI_sub3 %>%
select(permanent_address) %>%
group_by(permanent_address) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
names(pa_stats) <- c("Levels", "Obervations", "Percentage")
pa_stats2 <- FIHI_sub3 %>%
dplyr::filter(permanent_address=="Yes") %>%
dplyr::select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
pa_stats2 <- FIHI_sub3 %>%
dplyr::filter(permanent_address == "No") %>%
dplyr::select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
pa_stats2 <- FIHI_sub3 %>%
dplyr::select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
names(pa_stats2) <- c("Levels", "Obervations", "Percentage")
pa_stats2
pa_stats2 <- FIHI_sub3 %>%
dplyr::filter(permanent_address != 'Yes') %>%
dplyr::select(spent_night_elsewhere) %>%
group_by(spent_night_elsewhere) %>%
summarise(freq = n()) %>%
mutate(pct = round(freq*100/sum(freq), 2))
